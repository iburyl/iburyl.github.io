<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link href="css/main.css" rel="stylesheet" />
</head>
<body>

   <form id="myForm">
      Main CSV file (iNats format):<br />
      <input type="file" id="csvFile" accept=".csv" /><br />
      CSV file for Comparison report (iNats format):<br />
      <input type="file" id="csvFileCompare" accept=".csv" /><br />
      CSV file for Checklist report (one of columns should contain "scientific_name" with iNats compatible latin name and optionally "common_name" to use as name when main CSV has no observations):<br />
      <input type="file" id="csvFileChecklist" accept=".csv" /><br />
      <br />
      <input type="submit" name="main" value="New species by year report" />
      <input type="submit" name="compare" value="Comparison report" />
      <input type="submit" name="checklist" value="Checklist report" />
      <br /><br />
   </form>

<div id="instruction">
<h3>Instruction:</h3>
Any options here, then press red-circled link.<br />
   <img width=600 src="img/first.jpeg" /><br /><br />
Green-circled options are required, red-circled options should be avoided (the issues with those are fixed, but be cautious just in case).<br />
   <img width=600 src="img/second.png" /><br /><br />
Waiting for archive to be available.<br />
Download archive, unpack it...<br /><br />
Provide results CSV file to the form as Main CSV or Comparison CSV<br />
</div>

   <div id="detail_div"></div>
   <table id="table_years"></table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript" src="js/csv_to_array.js"></script>
<script type="text/javascript" src="js/lists_parsing.js"></script>
<script type="text/javascript" src="js/table_filling.js"></script>
<script type="text/javascript" src="js/details_overlay.js"></script>
<script type="text/javascript" src="js/utils.js"></script>

<script>

const myForm = document.getElementById("myForm");
const csvFile = document.getElementById("csvFile");
const csvFileCompare = document.getElementById("csvFileCompare");
myForm.addEventListener("submit", function (e) {
   e.preventDefault();
   const button_name = e.submitter.getAttribute("name");
   const input = csvFile.files[0];
   const compare_input = csvFileCompare.files[0];
   const checklist_input = csvFileChecklist.files[0];
   const reader = new FileReader();

   reader.onload = function (event) {
      const string = event.target.result;
      const observations = CSV2Observations(string);
      const speciesMap = Observations2SpeciesMap(observations);

      if( button_name == "main" )
      {
         generateYearsTable( speciesMap );
      }
      else if( button_name == "compare" )
      {
         const reader = new FileReader();
         reader.onload = function (compare_event) {
            const compare_string_csv = compare_event.target.result;
            const compare_observations = CSV2Observations(compare_string_csv);
            const compare_speciesMap = Observations2SpeciesMap(compare_observations);
     
            generateSpeciesSummaryTable( speciesMap, compare_speciesMap );
         };
         reader.readAsText(compare_input);
      }
      else if( button_name == "checklist" )
      {
         const reader = new FileReader();
         reader.onload = function (checklist_event) {
            const checklist_string_csv = checklist_event.target.result;
            const checklistMap = CSV2Checklist(checklist_string_csv);
     
            generateChecklistTable( speciesMap, checklistMap );
         };
         reader.readAsText(checklist_input);
      }
      
   };
   reader.readAsText(input);

});

</script>
</body>
</html>
